<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Users extends CI_Controller
{
    
    public function login(){
        
        $this->form_validation->set_rules('username','Username','trim|required|min_length[4]');
        $this->form_validation->set_rules('password','Password','trim|required|min_length[4]|max_length[50]');
        $username = $this->input->post('username');
        $password = $this->input->post('password');
        if($this->form_validation->run()==false){
            $this->load->view('users/login'); 
        }else{

        $user = $this->Users_model->login($username,$password);

        //Vallidating users data
        if($user){
            $data = array(
                'user_id' => $user['id'],
                'username' => $username,
                'logged_in' => true,
                );
            // Set session user_data

            $this->session->set_userdata($data);

            // Set message
            $this->session->set_flashdata('login','You are currently logged in');
            redirect('form/add');          
        }   else{

            // Set login error

            $this->session->set_flashdata('fail','Invalid user name or password');
            redirect('users/login');
        }

    }
}

    public function logout(){

        $this->session->unset_userdata('logged_in');
        $this->session->unset_userdata('user_id');
        $this->session->unset_userdata('Username');
        $this->session->sess_destroy();
        redirect('users/login');

        }


    public function register(){
        $this->form_validation->set_rules('username','Username','required');
        $this->form_validation->set_rules('password','Password','trim|required');
        $this->form_validation->set_rules('confirm','Password','trim|required|matches[password]');


        if ($this->form_validation->run()==false) {
                $this->load->view('users/register');            
        } else{

            $data = array(

                'username'=>$this->input->post('username'),
                'password'=>$this->input->post('confirm'),

            );

                $this->Users_model->insert($data); 
                $this->session->set_flashdata('registered','Login here');
                redirect('users/login');
            
        }
    }


         
    
    
}

/* End of file Users.php */
/* Location: ./application/controllers/Users.php */
/* Please DO NOT modify this information : */
/* Generated by Harviacode Codeigniter CRUD Generator 2019-04-14 14:03:25 */
/* http://harviacode.com */